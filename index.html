<!DOCTYPE html>
<html>
<head>
  <title>SoulSpeak</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>SoulSpeak</h1>
  <textarea id="letterInput" placeholder="Write your letter..."></textarea>
  <button onclick="submitLetter()">Save Letter</button>
  <div id="library"></div>

  <script>
    const supabase = supabase.createClient(
      "https://ictselnzuxbtrwcabbyu.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    );

    let userId = null;

    async function anonymousLogin() {
      const email = `user_${Date.now()}@soulspeak.com`;
      const password = "soulspeak123";
      const { data, error } = await supabase.auth.signUp({ email, password });
      if (error) return console.error(error);
      userId = data.user.id;
      loadLetters();
    }

    anonymousLogin();

    async function submitLetter() {
      const text = document.getElementById("letterInput").value;
      const publishAfter = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString();
      await supabase.from("letters").insert([{ text, user_id: userId, publish_after: publishAfter }]);
      alert("Letter saved.");
      document.getElementById("letterInput").value = "";
    }

    async function loadLetters() {
      const now = new Date().toISOString();
      const { data } = await supabase
        .from("letters")
        .select("text")
        .lte("publish_after", now)
        .order("created_at", { ascending: false });
      const container = document.getElementById("library");
      container.innerHTML = "";
      data.forEach(letter => {
        const div = document.createElement("div");
        div.textContent = letter.text;
        container.appendChild(div);
      });
    }
  </script>
</body>
</html>

